(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"174d":function(t,e,i){"use strict";i.r(e);var n=i("920b"),o=i("c488");for(var a in o)"default"!==a&&function(t){i.d(e,t,function(){return o[t]})}(a);i("91e8");var s=i("2877"),r=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports},"20ec":function(t,e,i){},"91e8":function(t,e,i){"use strict";var n=i("20ec"),o=i.n(n);o.a},"920b":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.xieyi=!1},t.e1=function(e){t.xieyi=!1},t.e2=function(e){t.xieyi=!1})},o=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},c488:function(t,e,i){"use strict";i.r(e);var n=i("e68f"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=o.a},e28b:function(t,e,i){"use strict";(function(t){i("6417"),i("921b");n(i("66fd"));var e=n(i("174d"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},e68f:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,i,n,o,a,s){try{var r=t[a](s),u=r.value}catch(c){return void i(c)}r.done?e(u):Promise.resolve(u).then(n,o)}function s(t){return function(){var e=this,i=arguments;return new Promise(function(n,o){var s=t.apply(e,i);function r(t){a(s,n,o,r,u,"next",t)}function u(t){a(s,n,o,r,u,"throw",t)}r(void 0)})}}var r={data:function(){return{content:"",xieyi:!1,sku_id:"",head:"",is_kai:0,pid:"",is_pt:0,pt_data:"",coupon_id:0,save_cache:{},order_id:0,getimg:this.$getimg,maskState:0,desc:"",payType:1,yunfei_money:0,couponList:[],addressData:{},state:"",buy_data:"",address:"",paying:"",coupon_text:"选择优惠券",coupon_money:0,obj:{msg:"",order_from:"xcx",payment_type:"wx",total_price:"",shoping_price:"",coupon_price:"",coupon_id:0,discount:""}}},onLoad:function(e){if(this.state=e.state,"buy"==e.state){var i=t.getStorageSync("buy");this.buy_data=i}if("car"==e.state){var n=t.getStorageSync("cart"),o=[],a={},s=0;for(var r in n){var u=n[r];console.log(r,u),u.radio?(o[s]=u,s++):a[r]=u}this.buy_data=o,this.save_cache=a}"如花商城商业版-授权"==this.buy_data[0].goods_name&&(this.xieyi=!0);var c=t.getStorageSync("pid");c&&(this.pid=c,console.log(c),this.is_pt=1,this.get_pid(c)),this.head=t.getStorageSync("userInfo"),this.is_kai=t.getStorageSync("is_kai"),t.removeStorageSync("is_kai"),console.log("onLoad",this.buy_data),this._load()},onShow:function(){var t=this;this.$api.http.get("address/get_default_address").then(function(e){t.address=e.data})},computed:{goods_money:function(){var t=this.buy_data,e=0;for(var i in t){var n=t[i];e+=n.price*n.num}return console.log("总价",e),e},pay_money:function(){return this.goods_money+this.yunfei_money-this.coupon_money}},methods:{_load:function(){var t=this;console.log("load"),this.$api.http.get("coupon/user/get_coupon").then(function(e){t.couponList=e.data}),this.get_yunfei(),this.$api.http.get("index/get_file?type=3").then(function(e){t.content=e})},jump_invoices:function(){t.navigateTo({url:"/pages/invoices/invoices"})},get_pid:function(e){var i=this;this.$api.http.get("pt/get_one_item",{id:e}).then(function(e){i.pt_data=e.data,t.removeStorageSync("pid")})},get_yunfei:function(){var t=this;console.log("get_yunfei",this.buy_data);var e=this.buy_data,i=[];for(var n in e){var o=e[n];i[n]={},i[n]["goods_id"]=o.goods_id,i[n]["num"]=o.num,console.log("v:",i)}console.log("get_obj",i),this.$api.http.post("product/get_shipment_price",i).then(function(e){t.yunfei_money=e.data})},toggleMask:function(t){var e=this,i="show"===t?10:300,n="show"===t?1:0;this.maskState=2,setTimeout(function(){e.maskState=n},i)},to_use:function(t){this.maskState=0,this.coupon_id=this.couponList[t].id?this.couponList[t].id:0;var e=this.couponList[t].reduce;this.coupon_money=e,this.coupon_text="已优惠"+e+"元"},cancel_use:function(){this.maskState=0,this.coupon_id=0,this.coupon_money=0,this.coupon_text="选择优惠券"},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},set_order_data:function(){console.log(this.buy_data),"[]"!=this.buy_data[0].discount?this.obj.discount=1:this.obj.discount=0;var e=this.obj;e.total_price=this.pay_money,e.shoping_price=this.yunfei_money,e.coupon_price=this.coupon_money,e.coupon_id=this.coupon_id,e.goods_id=this.buy_data[0].goods_id,e.price=this.buy_data[0].price,e.num=this.buy_data[0].num,e.order_from=0,e.payment_type="xcx",this.buy_data[0].pt&&(e.is_captain_sign=1),this.is_item=t.getStorageSync("is_item"),this.is_item&&(e.item_id=this.pt_data.id,t.removeStorageSync("is_item"));var i=this.buy_data,n={};for(var o in i){var a=i[o],s=a.goods_id;a.sku&&(s=a.goods_id+"-"+a.sku.id,this.sku_id=a.sku.id),n[s]=a,n[s].sku_id=0,a.sku&&(n[s].sku_id=a.sku.id),delete n[s].radio,delete n[s].sku,delete n[s].sku_name,delete n[s].goods_name}return e.json=n,console.log("obj",e),e},check_sub_data:function(){if(this.address){if(!this.paying){var t="";return t="order/create",console.log("url:",t),t}}else this.$api.msg("未填写地址")},submit:function(){var e=s(n.default.mark(function e(){var i,o,a,s,r,u;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.getStorageSync("is_item"),t.removeStorageSync("is_item"),o=this.check_sub_data(),o){e.next=5;break}return e.abrupt("return");case 5:if(a=this.set_order_data(),console.log("submit:",a),""==this.sku_id?a.sku_id=0:a.sku_id=this.sku_id,s="",1!=this.is_kai){e.next=16;break}return a.is_captain_sign=1,e.next=13,this.$api.http.post("pt/create_pt_item",a).then(function(t){return t});case 13:s=e.sent,e.next=27;break;case 16:if(1!=i){e.next=24;break}return a.item_id=this.pid,a.is_captain_sign=1,e.next=21,this.$api.http.post("pt/create_pt",a).then(function(t){return t});case 21:s=e.sent,e.next=27;break;case 24:return e.next=26,this.$api.http.post(o,a).then(function(t){return t});case 26:s=e.sent;case 27:if(this.paying=!0,console.log("创建订单：",s),s.data){e.next=33;break}return this.$api.msg(s.msg),setTimeout(function(){t.navigateBack({})},1e3),e.abrupt("return");case 33:return"buy"==this.state?t.removeStorageSync("buy"):(t.removeStorageSync("cart"),t.setStorageSync("cart",this.save_cache)),r=s.data,this.order_id=r,e.next=38,this.$api.http.post("order/pay/pre_order",{id:r}).then(function(t){return console.log("pay:",t),t});case 38:return u=e.sent,e.next=41,this.pay(u);case 41:case"end":return e.stop()}},e,this)}));function i(){return e.apply(this,arguments)}return i}(),wxPay:function(t){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",jsApiCall,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",jsApiCall),document.attachEvent("onWeixinJSBridgeReady",jsApiCall)):this.jsApiCall(t)},jsApiCall:function(e){var i=this;WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){if(WeixinJSBridge.log("a:",e.err_msg),"get_brand_wcpay_request:ok"==e.err_msg)return i.$api.msg("支付成功!"),void t.navigateTo({url:"../invite/invite?id="+i.pid});"get_brand_wcpay_request:cancel"==e.err_msg?i.$api.msg("取消支付"):i.$api.msg("支付失败"),setTimeout(function(){t.redirectTo({url:"/pages/order/order"})},1e3)})},pay:function(e){var i=this.order_id;t.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(e){console.log("success:",e),t.redirectTo({url:"/pages/user/myorder/myorder?id="+i})},fail:function(e){console.log("fail:"+JSON.stringify(e)),t.redirectTo({url:"/pages/user/myorder/myorder?id="+i})}})},app_pay:function(e){var i=this.order_id;t.requestPayment({provider:"wxpay",orderInfo:JSON.stringify(e),success:function(e){console.log("success:",e),t.redirectTo({url:"/pages/user/myorder/myorder?id="+i})},fail:function(e){console.log("fail:"+JSON.stringify(e)),t.redirectTo({url:"/pages/user/myorder/myorder?id="+i})}})}},onPullDownRefresh:function(){setTimeout(function(){t.stopPullDownRefresh()},2e3)}};e.default=r}).call(this,i("543d")["default"])}},[["e28b","common/runtime","common/vendor"]]]);