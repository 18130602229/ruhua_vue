(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/extend-view/productDetail/productDetail"],{"11b6":function(t,i,e){"use strict";var n=e("fc47"),s=e.n(n);s.a},"53a0":function(t,i,e){"use strict";e.r(i);var n=e("be52"),s=e.n(n);for(var o in n)"default"!==o&&function(t){e.d(i,t,function(){return n[t]})}(o);i["default"]=s.a},"9e01":function(t,i,e){"use strict";(function(t){e("6417"),e("921b");n(e("66fd"));var i=n(e("d629"));function n(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},be52:function(t,i,e){"use strict";(function(t){function n(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function s(t,i){return r(t)||a(t,i)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(t,i){var e=[],n=!0,s=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)if(e.push(a.value),i&&e.length===i)break}catch(u){s=!0,o=u}finally{try{n||null==r["return"]||r["return"]()}finally{if(s)throw o}}return e}function r(t){if(Array.isArray(t))return t}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var u=function(){return e.e("components/uni/uni-countdown/uni-countdown").then(e.bind(null,"978f"))},c=function(){return e.e("components/icon/icon").then(e.bind(null,"a222"))},l=function(){return e.e("components/tag/tag").then(e.bind(null,"ca14"))},h=function(){return e.e("components/badge/badge").then(e.bind(null,"4cd1"))},p=function(){return e.e("components/nomore/nomore").then(e.bind(null,"d22a"))},d=function(){return e.e("components/button/button").then(e.bind(null,"2ddc"))},_=function(){return e.e("components/top-dropdown/top-dropdown").then(e.bind(null,"6d4d"))},g=function(){return e.e("components/bottom-popup/bottom-popup").then(e.bind(null,"4788"))},m=function(){return e.e("components/numberbox/numberbox").then(e.bind(null,"4701"))},f=function(){return e.e("components/hch-poster/hch-poster").then(e.bind(null,"e34f"))},v={components:{tuiIcon:c,tuiTag:l,tuiBadge:h,tuiNomore:p,tuiButton:d,tuiTopDropdown:_,tuiBottomPopup:g,tuiNumberbox:m,uniCountdown:u,hchPoster:f},data:function(){return{is_new_pt:!1,is_auto:"",my:"",pro_type:0,is_timeup:1,remain:[],time_list:[],pindan:[],is_pt:!1,is_pindan:!1,discount_start:0,discount_time:{days:"",hours:"",minutes:"",seconds:""},end_time:"",canvasFlag:!0,posterData:{},content:"",xz_sku_name:"",x:0,sku_index:"",num:1,getimg:this.$getimg,is_vip:0,shop_car_num:"",vid:0,sku_arr:"",poster:{},qrShow:!1,is_share:!1,detail:!0,couponList:[],maskState:0,height:64,top:0,scrollH:0,opcity:0,iconOpcity:.5,banner:{url:"http://www.thorui.cn/img/product/11.jpg",url1:"http://www.thorui.cn/img/product/33.jpg"},bannerIndex:0,menuShow:!1,popupShow:!1,goods_num:1,id:"",zk_price:"",list:{},applist:[],collected:"",detailData:"",shareList:""}},onLoad:function(i){var e=this;this.id=i.id,this.is_like(i.id),this.load_data(),this._load();var n=t.getStorageSync("cart");if(n){var s=Object.entries(n).length;this.shop_car_num=s}else this.shop_car_num=0;var o={};o=wx.getMenuButtonBoundingClientRect(),t.getSystemInfo({success:function(t){e.width=o.left||t.windowWidth,e.height=o.top?o.top+o.height+8:t.statusBarHeight+44,e.top=o.top?o.top+(o.height-32)/2:t.statusBarHeight+6,e.scrollH=t.windowWidth}})},computed:{price:function(){var t=1*this.list.price,i=t;return this.zk_price>0&&(i=t-this.zk_price),this.list.pt&&this.list.pt.price>0&&(i=t-this.list.pt.price),i.toFixed(2)},banner_length:function(){var t=this.list.banner_imgs_url.length,i=this.list.video?1:0;return t+i},zk_status:function(){var t=0,i=0,e=(new Date).getTime();if(this.list.discount&&this.list.discount.discount){!0;var n=this.list.discount.discount.start_time,s=this.list.discount.discount.end_time;return t=new Date(n).getTime(),i=new Date(s).getTime(),console.log("限时开始：",t,"限时结束：",i),e<t?"wait":e>=t&&e<i?"start":e>t&&e>=i?"end":void 0}},label_name:function(){if(this.list.discount&&this.list.discount.discount&&this.list.discount.discount.label)return this.list.discount.discount.label}},methods:{videoErrorCallback:function(i){t.showModal({content:i.target.errMsg,showCancel:!1})},showPopupxx:function(){this.popupShow=!0;var i=1;t.setStorageSync("is_kai",i)},timeup:function(){this.is_timeup=0},shareFc:function(){var t=this;console.log("生成海报"),Object.assign(this.posterData,{url:this.getimg+this.list.imgs,icon:"https://img0.zuipin.cn/mp_zuipin/poster/hch-hyj.png",title:this.list.goods_name,discountPrice:this.list.price,orignPrice:this.list.market_price,code:"https://img0.zuipin.cn/mp_zuipin/poster/hch-code.png"}),this.$forceUpdate(),setTimeout(function(){t.canvasFlag=!1,t.is_share=!1,t.$refs.hchPoster.createCanvasImage()},500)},load_data:function(){var i=this;t.showLoading({title:"加载中"}),setTimeout(function(){t.hideLoading()},2e3);var e=this.$api.http.get("product/get_evaluate?id=",{id:this.id}),n=this.$api.http.get("coupon/get_coupon");Promise.all([e,n]).then(function(e){i.applist=e[0].data[0],i.couponList=e[1].data,t.hideLoading()})},_load:function(){var t=this;this.$api.http.get("product/get_product?id=",{id:this.id}).then(function(i){if(t.detail=!i.data.discount.id,t.detail||(t.zk_price=1*i.data.discount.reduce_price),t.list=i.data,console.log(i.data),i.data.video?t.is_auto=!1:t.is_auto=!0,t.list.discount.discount){var e=t.list.discount.discount.end_time,n=(new Date).getTime(),o=new Date(e).getTime();if(o>n)var a=o-n,r=(Math.floor(a/864e5),o-n),u=Math.floor(r/864e5),c=r%864e5,l=Math.floor(c/36e5),h=c%36e5,p=Math.floor(h/6e4),d=h%6e4,_=Math.round(d/1e3);t.discount_time.days=u,t.discount_time.hours=l,t.discount_time.minutes=p,t.discount_time.seconds=_;var g=t.list.discount.discount.start_time,m=new Date(g).getTime(),f=n;console.log("当前时间",f),console.log("开始时间",m),f>m?(t.discount_start=1,console.log("活动已开启")):(t.discount_start=0,console.log("活动还未开始"))}i.data.pt.price&&(t.is_pt=!0,t.$api.http.get("pt/get_item",{id:t.id}).then(function(i){t.pindan=i.data,t.get_time(i.data)}),1==i.data.pt.pt.is_new_user&&(t.is_new_pt=!0));var v=new RegExp('style=""',"gi");i.data.content=i.data.content.replace(v,"");var k=new RegExp("<img","gi");if(t.content=i.data.content.replace(k,'<img style="max-width: 100%; height: auto"'),t.list.sku_arr&&(t.sku_arr=t.list.sku_arr,t.xz_sku_name="请选择规格"),i.data.sku.length>0){i.data.sku_arr.initialSku={},i.data.sku_arr.initialSku["selectedNum"]=1;for(var b=Object.entries(i.data.sku_arr.tree),w=0;w<b.length;w++){var y=s(b[w],2),S=(y[0],y[1]);i.data.sku_arr.initialSku[S.k_s]=""}}t.get_pro_type(i.data)}),this.$api.http.get("user/info").then(function(i){t.my=i.data,t.my.vip&&(t.is_vip=1)})},get_pro_type:function(t){var i=this;if("[]"==t.discount)return"[]"!=t.pt?(i.pro_type="pt",void(1==t.pt.pt.is_new_user&&(i.pro_type="new_pt"))):void(this.pro_type="pro");this.pro_type="xs"},get_time:function(t){for(var i in t){var e=t[i];this.time_list.push(e.item_time)}for(var n in console.log(this.time_list),this.time_list){var s=this.time_list[n];this.remain.push(this.zhuan_time(s))}console.log(this.remain)},zhuan_time:function(i){var e={h:"",m:"",s:""},n=(new Date).getTime(),s=1e3*i-n,o=parseInt(s/1e3/60/60%24),a=parseInt(s/1e3/60%60),r=parseInt(s/1e3%60);return console.log(o+"-"+a+"-"+r),e.h=o,e.m=a,e.s=r,t.setStorageSync("time",e),e},is_like:function(t){var i=this;this.$api.http.post("favorite/get_one_fav",{id:t}).then(function(t){t.data?i.collected=!0:i.collected=!1})},canvasCancel:function(t){this.canvasFlag=t},sku_change_num:function(t){console.log("num:",t.value);var i=t.value,e=this.list;e.sku.length>0?e.sku_arr.initialSku.selectedNum=i:(e.sku_arr.initialSku={},e.sku_arr.initialSku.selectedNum=i),console.log("num2:",i),this.list=e,this.num=i},change_sku_img:function(t){var i=this.list.sku_arr.tree[0].v;console.log("sku_img",i);for(var e=Object.entries(i),n=0;n<e.length;n++){var o=s(e[n],2),a=(o[0],o[1]);console.log("sku_img_v",a),t==a.id&&a.imgUrl&&(this.list.imgs=a.imgUrl)}},xz_sku_cs:function(t,i){var e=this.list,n=e.sku_arr.initialSku;n[t]=i,this.change_sku_img(i);for(var o=Object.keys(n).length-1,a=e.price,r=e.stock,u="",c=-1,l=Object.entries(e.sku_arr.list),h=0;h<l.length;h++){var p=s(l[h],2),d=p[0],_=p[1];1==o&&n["s1"]==_["s1"]&&(a=_.price,r=_.stock_num,u=_["s1_name"],c=d),2==o&&n["s1"]==_["s1"]&&n["s2"]==_["s2"]&&(a=_.price,r=_.stock_num,u=_["s1_name"]+" "+_["s2_name"],c=d),3==o&&n["s1"]==_["s1"]&&n["s2"]==_["s2"]&&n["s3"]==_["s3"]&&(a=_.price,r=_.stock_num,u=_["s1_name"]+" "+_["s2_name"]+" "+_["s3_name"],c=d)}e.price=a,e.stock=r,e.sku_name=u,this.xz_sku_name=e.sku_name,this.list=e,this.sku_index=c,this.x++,console.log("sku_index:",c)},add_cart:function(){var i=this;if(this.check_sku()){var e=this.sku_index,n=this.list.goods_id;e>=0&&(n=n+"-"+e),console.log("cache",n,e);var o={},a=t.getStorageSync("cart"),r=Object.keys(a).length;if(r>0){for(var u=Object.entries(a),c=0;c<u.length;c++){var l=s(u[c],2),h=l[0];l[1];if(n==h)return void i.$api.msg("已存在")}a[n]=this._setOrderData(),t.setStorageSync("cart",a),this.shop_car_num++}else o[n]=this._setOrderData(),t.setStorageSync("cart",o),this.shop_car_num=1;i.$api.msg("加入成功"),this.popupShow=!1}},add_shopping:function(){if(this.check_sku()){console.log("add_shopping");var i=this._setOrderData();if(i){i["goods_id"];t.setStorageSync("buy",{0:i}),t.redirectTo({url:"/pages/order/createOrder?state=buy"})}}},check_sku:function(){console.log("check_sku");var t=this;if(this.list.sku.length<1)return!0;for(var i=this.list.sku_arr.initialSku,e=Object.entries(i),n=0;n<e.length;n++){var o=s(e[n],2),a=(o[0],o[1]);if(""==a)return t.$api.msg("未选择规格"),!1}return!0},_setOrderData:function(){console.log("price:",this.price);var t=this,i=this.sku_index,e=this.list;if(0!=e.stock){var n={};return n["goods_id"]=e.goods_id,n["goods_name"]=e.goods_name,n["shopping_fee"]=e.shipping_fee,n["radio"]=!0,n["imgs"]=e.imgs?e.imgs:"",n["price"]=this.price,n["num"]=this.num,n["stock"]=e.stock,e.sku.length>0&&(n["num"]=e.sku_arr.initialSku.selectedNum,n["sku"]=e.sku_arr.list[i],n["sku_name"]=e.sku_name),e.discount&&(n["discount"]=e.discount),e.pt.price&&(n["pt"]=e.pt,n["pindan_data"]=this.pindan),n}t.$api.msg("库存不足")},lq_coupon:function(t){var i=this;this.$api.http.get("coupon/add_coupon",{id:t}).then(function(t){200==t.status&&i.$api.msg("领取成功"),400==t.status&&i.$api.msg(t.msg)})},toggleMask:function(t){var i=this,e="show"===t?10:300,n="show"===t?1:0;this.maskState=2,setTimeout(function(){i.maskState=n},e)},jump_tohome:function(){t.switchTab({url:"/pages/index/index"})},jump_vip:function(){t.navigateTo({url:"/pages/user/member/member"})},jump_to:function(){t.setStorageSync("buy",this.list),t.navigateTo({url:"../../order/createOrder?state=buy"})},jump_toshop:function(){t.navigateTo({url:"../../shop/shop"})},jump_toevaluate:function(i){t.navigateTo({url:"../../evaluate/evaluate?id="+i})},jump_tocart:function(){t.switchTab({url:"../../cart/cart"})},bannerChange:function(t){this.bannerIndex=t.detail.current},bigimage:function(i){var e=[],s=this.$getimg;for(var o in this.list.banner_imgs_url){var a=this.list.banner_imgs_url[o];e[o]=s+a}console.log("arr:",e),t.previewImage(n({current:0,urls:e},"current",i))},back:function(){t.navigateBack()},openMenu:function(){this.menuShow=!0},closeMenu:function(){this.menuShow=!1},showPopup:function(){this.popupShow=!0},showPopups:function(i){this.popupShow=!0,t.setStorageSync("pid",i),t.setStorageSync("is_item",1)},hidePopup:function(){this.popupShow=!1},change:function(t){this.value=t.value},collecting:function(){var t=this;if(this.collected)this.$api.http.put("favorite/del_fav",{id:this.id}).then(function(i){t.$api.msg("取消收藏")});else{var i={fav_id:this.id,type:"goods",price:this.list.price};this.$api.http.post("favorite/add_fav",i).then(function(i){t.$api.msg("收藏成功")})}this.collected=!this.collected}},onPageScroll:function(t){var i=t.scrollTop<=0?0:t.scrollTop,e=i/this.scrollH;this.opcity>=1&&e>=1||(this.opcity=e,this.iconOpcity=.5*(1-e<0?0:1-e))},onShareAppMessage:function(t){return{title:"如花"}},onPullDownRefresh:function(){this._load(),setTimeout(function(){t.stopPullDownRefresh()},2e3)}};i.default=v}).call(this,e("543d")["default"])},d629:function(t,i,e){"use strict";e.r(i);var n=e("f8a4"),s=e("53a0");for(var o in s)"default"!==o&&function(t){e.d(i,t,function(){return s[t]})}(o);e("11b6");var a=e("2877"),r=Object(a["a"])(s["default"],n["a"],n["b"],!1,null,null,null);i["default"]=r.exports},f8a4:function(t,i,e){"use strict";var n=function(){var t=this,i=t.$createElement,n=(t._self._c,e("3888")),s=e("3104"),o=e("94d1");t._isMounted||(t.e0=function(i){t.is_share=!0},t.e1=function(i){t.is_pindan=!0},t.e2=function(i){t.is_share=!1},t.e3=function(i){t.is_share=!1},t.e4=function(i){t.is_pindan=!1},t.e5=function(i){t.is_pindan=!1}),t.$mp.data=Object.assign({},{$root:{m0:n,m1:s,m2:o}})},s=[];e.d(i,"a",function(){return n}),e.d(i,"b",function(){return s})},fc47:function(t,i,e){}},[["9e01","common/runtime","common/vendor"]]]);